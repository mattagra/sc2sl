<% if current_user %>
  <div id="newcomment">
    <%= form_for(@comment) do |f| %>
      <% if @comment.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@comment.errors.count, "error") %> prohibited this comment from being saved:</h2>

          <ul>
            <% @comment.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
      <%= f.hidden_field :external_type %>
      <%= f.hidden_field :external_id %>
      <%= hidden_field_tag :back_url, params[:back_url] || request.fullpath  %>
    <% if current_moderator %>
      <div class="field">
        <%= f.label :locked %><br />
        <%= f.check_box :locked %>
      </div>
    <% end %>
      <div class="field">
        <%= f.label :description %><br />
        <%= f.text_area :description, :cols => 75, :rows => 10, :id => :bbcode %>
      </div>
      <div class="actions">
        <%= f.submit %>
      </div>
    <% end %>
  </div>
<% else %>
  You must <%= link_to "register", register_path %> or <%= link_to "login", login_path %> to comment.
<% end %>
